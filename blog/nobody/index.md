---
layout: post
title:  "아무도 가르쳐 주지 않는 것"
subtitle: "아무도 안 가르쳐 주는 내용을 적어 봤다."
type: "Development"
blog: true
text: true
comments: true
author: ""
post-header: true
header-img: "img/github.jpg"
order: 1
---

학생일 때는 전혀 몰랐지만 직업을 갖고 일을 시작하니 정말 중요했던 것들이다. 그러나 아무도 가르쳐 주지 않았고 당연하듯이 이런게 있는듯 행동하는 회사에서 적응하기 위해 애를 많이 써야 했다. 

# Log

설령 간단하게 장난감을 만들어 테스트를 해 보더라도 logging을 하는 것을 추천한다. 로그는 나중에 실제 서비스를 시작 했을 때 내 프로그램을 얼마나 많은 사람이 이용하는지 분석하는데 큰 도움이 된다. 

무엇보다 Exception이 발생 했을 때 error log를 남기는 것이 중요하다. 뭔가 일이 터졌는데 어쩌다 이렇게 error가 났었는지 기록으로 남아야 한다. 그래야 나중에라도 내가 무엇을 잘못 한 건지 분석을 해 볼테니 말이다. 프로그램이 정상적으로 작동하지 않고 갑자기 꽥 죽어 버렸는데 error log는 남아 있지 않다면 참으로 난감해진다. 말 그대로 누가 돌연사 해 버렸는데 부검도 못하는 상황인 것이다. 

특히 Java에서 try catch 구문을 쓸 때 catch 내부는 아래와 같이 두는 경우가 정말 많았다. 그냥 Exception을 catch하기만 하고 아무런 처리도 하지 않는 경우도 많았다. 

    try {
    	doSomething();
    } catch(IOException e) {
    	e.printStackTrace(); // default.
    }

### Log Rotation

logging 라이브러리를 잘 썼다고 치자 사실 이런다고 끝이 아니다. 막상 어플리케이션을 서버에서 실행하고 서비스를 하기 시작하면 날이 갈 수록 로그가 쌓여가기 시작한다. 1년 동안 서비스를 했다면 365개의 파일이 생기는 것이다.

log는 text로만 이루어져 있지만 이게 은근히 용량을 많이 차지한다. 인기 서비스라면 하루에 수천만 개의 로그가 쌓이고 사용자까지 많다면 억대로 쌓이는 경우도 봤다. 로그를 자세히 남긴다면 하루치 로그가 100GB를 넘는 것은 일도 아니다. 대형 포털에서 일하게 된다면 반드시 그럴 것이다. 나도 처음엔 text로만 이뤄진 log file을 만만하게 생각했었다. 내가 담당하던 서비스의 log가 너무 쌓여서 서버의 디스크가 꽉 차 버리는 바람에 경고 메세지를 받은 적이 있다. 당시 영화관에서 있었는데 끊고 나가긴 아까워서 무시하고 있었는데 85%... 90%... 빠르게 디스크 공간을 차지 해 가는 로그 때문에 중간에 급히 나와야만 했다.

결국 프로그래밍을 해도 끝난게 아닌 것이다. 코드를 잘 써서 예외 처리를 잘해도 로그를 잘 남겨야 하고, 로그를 잘 남기면 로그가 꽉 차지 않도록 log rotation이 잘 되도록 해야 한다. 무엇하나 간단하게 없고 할게  너무 많다.

# ENV

리눅스를 잘 다루면 좋다는 점은 아무리 말 해도 지나치지 않을 것이다. environment는 특히 node를 다룰 때 많이 접하게 된다. 환경변수 설정으로 development 환경이냐, production 환경을 구분해서 logging을 하도록 하면 print로 코드가 지저분 해지는 것을 잘 막을 수 있다. 조금 더 힘을 내서 stage까지 만들어 둔다면 나중에 서비스를 테스트하는데 큰 도움이 된다.

# config

설정들을 어떻게 관리 할 것인가? 혼자 개발하면서는 딱히 신경이 가지 않아 대학생 때는 잘 느끼지 못해서 경험이 없는 채로 졸업하게 된다. 예를들어 어떤 데이터 베이스에 접속하는 코드가 있다고 가정하자.

    redis.Redis(host='redis-us-east', charset='utf-8', password='WCaZYz7Kn14vdvw')

이렇게 하면 당연하게도 host나 password가 코드 내에 여실히 드러나게 되어 썩 우아하지 않아 보인다. 나는 이렇게 하는 것이 무언가 전문적이게(?) 보이지 않는다는 느낌을 받았지만 구체적으로 무엇이 문제인지 짚어내지 못했다. 가장 흔히 들어 온 것이 host가 바뀌거나 할 경우 곳곳에 산재한 host 주소를 바꾸기가 귀찮다는 것이다. 그러나 어차피 혼자 개발하면서 이런 코드는 거의 한 번만 쓰이게 되기에 고개를 끄덕이기가 어려웠다.

그러나 개발 경험이 쌓인 이제는 확실한 단점 몇가지를 말 할 수 있게 되었다. 

- dev 환경용 데이터베이스와 prod 환경용 데이터 베이스 주소가 다를 수 있다. 이 경우 ENV에 따라 host가 바뀔 수 있다면 좋을 것이다. stage1, stage2 등의 다른 환경의 host가 쓰일 수도 있다.
- password를 안전하게 보관해야한다. 코드에 password를 써 두면 git push하는 순간 비밀번호가 외부에 노출된다. API secret key나 각종 access token들도 마찬가지로 겪는 문제이다. 이런 key를 담은 config file들은 암호화하여 push하는 등의 방법이 있다.

Heroku나 Dokku를 사용한다면 config var를 사용 할 수 있다. dyno 설정에서 config var를 직접 입력 할 수 있다.

# CI/CD

git commit과 git push 한 번으로 테스트와 배포를 자동으로 할 수 있다. 이 사실을 알았을 때 얼마나 충격이었는지 모른다. 내가 학생일 때는 이런걸 가르쳐 준 사람이 없었다.

요즘에는 워낙 좋은 PaaS와 서비스들이 많아서 CI/CD가 뭔지 잘 몰라도 버튼 몇번이면 다 해 낼 수 있다. 

정말 간단하게 CI/CD를 해내고 싶으면 heroku를 무료 버전으로 써도 좋다. Gitlab도 좋다. gitrunner를 사용하는 방법에 대해서 한 번 써보고 싶다. 유료이긴 하지만 Digital Ocean도 좋았다. 학생이라면 50$를 무료 크레딧으로 제공한다. 1년 정도는 쓸 수 있는 액수다.

결국 일주일에 몇번 Deploy하느냐 얼마나 자주 deploy를 할 수 있느냐가 App Quality에 영향을 미치게 됐다. 수 년전 부터 Facebook과 Twitter의 모바일 앱은 Quality Improvement라는 짤막한 내역과 함께 Regular update를 하기 시작했다. 장난으로라도 개발을 할 때는 CD가 갖춰지면 매우 편하다. 어쨌든 열심히 코드만 다듬으면 되니까.

# git

이건 요즘 학생들도 많이 알고 많이 배우고 나보다 더 잘 알 것이라 생각한다. 때문에 다른 것 보다는 간단하게 적으려 한다. 그러나 극단적으로 말해서 소위 말하는 지잡대에서는 교수가 git을 수업에 시도할 엄두도 못내어 어렴풋이 들어본 정도가 대부분일 수도 있다. 최근에는 github와 git이 같은 것인줄 아는 개발자를 본 적도 있다. git은 버전 관리 소프트웨어이고 github는 git을 사용하여 서비스하는 것임을 모르고 있던 것이다. 

# Test

수많은 글들이 TDD를 주창하고 TDD를 설명하고 있다. test가 전혀 뭔지 몰라도 배울 수 있는 좋은 포스팅이 많다. 그러나 내가 가장 싫어하는 것이 test다. 일단 test를 작성하기 시작하면은 재미있고 CI가 완성 되면 매우 편해지지만 회사에도 가장 실현하기 어렵고 지속되기 어려운 것이 test가 아닐까 생각한다. 

테스트 코드를 먼저 작성하고 개발을 시작하는 건 참 따분한 일이다. 특히 나는 얼른 멋진 코드를 치고 나서 프로그램이 동작하는 걸 먼저 보고싶은 마음이 급했다.

REST API 서버를 개발하고 있다고 치자, 최소한 request에 대해 200 OK status가 오는지 확인 하는 코드 한 줄이라도 있는 것이 좋다고 생각한다. 

최소한의 테스트 코드라도 작성 해 두면 git push를 할 때, deploy를 할 때 망설임이 없게 된다. 필요한 코드를 쓸 때도 부담이 덜 하다. 만약 내가 뭔가 잘못 했다면 테스트 코드가 검증을 해 낼 테니까. 

# AMP/Analytics

자신이 만든 프로그램을 잘 배포 했다면 프로그램이 잘 동작하는지 확인 하여야한다. 

pm2의 경우 나름대로 멋진 UI를 가진 moniotring 플랫폼을 제공하고 있다. 

iOS 또는 Android App을 개발한다면 firebase의 Analytics를 사용 해 볼법도 하다. Web이라면 Google Analytics를 생각 해 볼 수도 있다. 

실제 회사에서 서비스를 하나 런칭하고 나면은 질리도록 말하는 '성장'을 위해서 여러가지 분석을 하게 된다. 사용자 연령층은 어떠한지 성별은 어떤지 사용 시간과 어떤 메뉴를 얼마만큼 누르는지 데이터를 통해 또 다른 직감을 얻어나간다. 

학생이야 재미있게 만들어서 배포한 뒤에 여러가지 개선점을 스스로 생각하면된다. 만약 배포한 프로그램이 좋은 인기를 얻어 몇몇 사람들이 리뷰를 해 준다면 더 좋을 것이다. 내 앱을 어떤 사람들이 그리고 어떤 디바이스를 사용해서 어떻게 사용하고 있는지 데이터를 체계적으로 축적 해 둔다면 또 질리도록 말하는 '인사이트'를 기르는데 많은 도움이 된다. 

Sentry

로그와 에러 관리가 너무 귀찮을 때는 sentry를 추천한다. Exception이 발생하면 자동으로 스택 트레이스 정보를 포함한 이슈를 등록 해 줘서 나중에 신경을 써 주기가 매우 쉽다. 장난감 프로젝트들은 회사 일도 아니라서 개발 해 놓고 신경을 쓰기가 무척 어렵다. 특히 Exception들은 log를 뒤져 찾아 내는 것도 귀찮고 따로 메모를 해 놓자는 그건 더 귀찮다.

Google Analytics / Firebase

GA로 많이들 언급하는 구글 애널리틱스는 꼭 개발자들만이 알고 있는 것은 아니다. 마케팅을 일삼는 사람들 역시 GA를 공부하곤 한다. 

## Debugging / Profiling

가장 잘 해야 하는 것이고 중요한 부분이 될지도 모르겠다. 한창 개발만 부여잡다가 어느 날 스택을 추적하거나 디버깅을 해야 할 상황이 생겼을 때 어떤 버튼을 눌러야 되는지 조차 몰랐다. 자신에게도 너무 부끄러운 순간이었다. 디버깅을 하는 방법은 반드시 알아두도록 하자.

프로파일링은 함수의 실행 시간이나 이벤트가 발생한 빈도 등을 측정해 내 프로그램의 성능을 높이고자 함이다. 썩 괜찮게 만들어 놨다고 생각해도 막상 프로파일러로 실행 시간을 보면 분명히 실수하거나 이전에는 몰랐던 지식 때문에 크게 느려지는 구간이 하나 쯤 나타난다. 

### Flow

콘솔 화면이 아무리 멋있다지만 시각화 해 줄 수 있는게 최고다. Spring으로 개발을 할 때 자주 사용했었고 병목구간을 많이 잡아 냈었다. 

### Lighthouse

내가 만든 페이지가 옹골찬 PWA 페이지인지 검사 해주는 툴이다.